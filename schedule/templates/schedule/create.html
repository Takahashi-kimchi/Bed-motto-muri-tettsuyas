{% extends 'base.html' %}

{% block title %}æˆæ¥­ã®è¿½åŠ {% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    <div style="margin-bottom: 20px;">
        <a href="{{ back_url }}" style="text-decoration: none; color: var(--accent-color); font-weight: bold;">â† æ™‚é–“å‰²ã«æˆ»ã‚‹</a>
    </div>

    <div class="card">
        <h1 style="font-size: 1.5em; margin-bottom: 10px; color: var(--text-main);">âœ¨ æ–°ã—ã„æˆæ¥­ã‚’è¿½åŠ </h1>
        <p style="color: var(--text-sub); margin-bottom: 25px;">{{ day.name }} {{ period.name }} ã«ç™»éŒ²ã—ã¾ã™</p>

        <form method="post">
            {% csrf_token %}

            {# ========== é‡è¤‡è­¦å‘Šã‚¨ãƒªã‚¢ ========== #}
            {% if existing_course %}
                <div id="duplicate-warning" style="margin-bottom: 30px; padding: 20px; background-color: #fff3cd; border: 2px solid #ffecb5; border-radius: 12px; color: #856404;">
                    <h3 style="margin-top: 0; display: flex; align-items: center; gap: 10px; font-size: 1.2em;">
                        âš ï¸ ç™»éŒ²æ¸ˆã¿ã®æˆæ¥­ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
                    </h3>
                    <p style="font-size: 0.95em; margin-bottom: 15px;">
                        åŒã˜åå‰ãƒ»åŒã˜æ‹…å½“æ•™å“¡ã®æˆæ¥­ãŒæ—¢ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ã‚Šã¾ã™ã€‚<br>
                        æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†åˆ©ç”¨ã—ã¾ã™ã‹ï¼Ÿ
                    </p>

                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0; display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background-color: {{ existing_course.color }}; border: 1px solid rgba(0,0,0,0.1);"></div>
                        <div>
                            <div style="font-weight: bold; font-size: 1.1em; color: var(--text-main);">{{ existing_course.name }}</div>
                            <div style="font-size: 0.9em; color: var(--text-sub);">
                                æ•™å“¡: {{ existing_course.instructor|default:"æŒ‡å®šãªã—" }} / æ•™å®¤: {{ existing_course.room|default:"æŒ‡å®šãªã—" }}
                            </div>
                        </div>
                    </div>

                    <div style="font-size: 0.9em; margin-bottom: 20px;">
                        <strong>ğŸ’¡ å†åˆ©ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆ:</strong><br>
                        èª²é¡Œ(ToDo)ã‚„ãƒ¡ãƒ¢ãŒã€ä»–ã®æ›œæ—¥ã®ã‚³ãƒã¨è‡ªå‹•çš„ã«å…±æœ‰ãƒ»åŒæœŸã•ã‚Œã¾ã™ã€‚
                    </div>

                    <div style="display: flex; gap: 10px; flex-direction: column;">
                        <button type="submit" name="confirm_reuse" value="true" style="background-color: #856404; color: white; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
                            ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç´ä»˜ã‘ã‚‹ (æ¨å¥¨)
                        </button>
                        <button type="button" onclick="unlockForm()" style="background-color: transparent; border: 1px solid #856404; color: #856404; padding: 10px; border-radius: 6px; cursor: pointer;">
                            åˆ¥ã®æˆæ¥­ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ (æƒ…å ±ã‚’ä¿®æ­£)
                        </button>
                    </div>
                </div>
            {% endif %}

            {# ========== å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ (IDã‚’è¿½åŠ ) ========== #}
            <div id="input-fields" style="display: grid; gap: 20px; transition: all 0.3s; {% if existing_course %}opacity: 0.5; pointer-events: none; filter: grayscale(100%);{% endif %}">
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 8px;">æˆæ¥­å</label>
                    {{ course_form.name }}
                </div>

                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 8px;">ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        {{ course_form.color }}
                        <div id="color-preview" style="width: 20px; height: 20px; border-radius: 50%; border: 1px solid var(--border-color); background-color: #e2e8f0;"></div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; font-weight: bold; margin-bottom: 8px;">æ‹…å½“æ•™å“¡</label>
                        {{ course_form.instructor }}
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; margin-bottom: 8px;">æ•™å®¤</label>
                        {{ course_form.room }}
                    </div>
                </div>

                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 8px;">æ¦‚è¦ãƒ»ãƒ¡ãƒ¢</label>
                    {{ course_form.description }}
                </div>
                
                <button type="submit" style="width: 100%; margin-top: 10px; background-color: #28a745; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1em;">
                    ã“ã®å†…å®¹ã§æ–°è¦ç™»éŒ²
                </button>
            </div>

        </form>
    </div>
</div>

<script>
    // è‰²ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
    const colorSelect = document.querySelector('select[name="color"]');
    const colorPreview = document.getElementById('color-preview');
    if(colorSelect && colorPreview) {
        colorPreview.style.backgroundColor = colorSelect.value;
        colorSelect.addEventListener('change', (e) => {
            colorPreview.style.backgroundColor = e.target.value;
        });
    }

    // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ­ãƒƒã‚¯è§£é™¤æ©Ÿèƒ½
    function unlockForm() {
        const inputArea = document.getElementById('input-fields');
        const warningArea = document.getElementById('duplicate-warning');
        
        // è­¦å‘Šã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤ºã«ã™ã‚‹ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çš„ã«æ¶ˆã™ï¼‰
        warningArea.style.display = 'none';

        // å…¥åŠ›ã‚¨ãƒªã‚¢ã®ãƒ­ãƒƒã‚¯ã‚’è§£é™¤
        inputArea.style.opacity = '1';
        inputArea.style.pointerEvents = 'auto';
        inputArea.style.filter = 'none';

        // åå‰å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        const nameInput = document.querySelector('input[name="name"]');
        if(nameInput) nameInput.focus();
    }
</script>

<style>
    input[type="text"], textarea, select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-bg); color: var(--text-main); box-sizing: border-box; }
    textarea { height: 100px; resize: vertical; }
</style>
{% endblock %}